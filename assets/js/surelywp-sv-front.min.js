"use strict";jQuery(document).ready((function(e){if(e("#customer-service-notification-icon").length>0)var r=setInterval((function(){if(e('sc-tab[aria-label="'+sv_front_ajax_object.service_tab_lable+'"]').length>0){var t=e("#customer-service-notification-icon");t.remove(),t.removeClass("hidden"),e('sc-tab[aria-label="'+sv_front_ajax_object.service_tab_lable+'"]').append(t),clearInterval(r)}}),1e3);let t=!1,s=!1;if(e(document).on("click",".wp-block-surecart-product-buy-button",(function(r){e(".surelywp-sv-requirement-form").length&&!t&&(r.preventDefault(),s=r,e(".surelywp-sv-requirement-form").submit())})),e(".surelywp-sv-notification-alert").length){var a=getCookie("surelywp_sv_notification_count");if(null!==a)parseInt(e(".surelywp-sv-notification-alert").data("notification-count"))<=(a=parseInt(a))&&e(".surelywp-sv-notification-alert").remove()}e(document).on("click",".dismiss-notification",(function(r){var t=window.location.hostname,s=parseInt(e(".surelywp-sv-notification-alert").data("notification-count"));setCookie("surelywp_sv_notification_count",s,1,"/",t,!0),e(".surelywp-sv-notification-alert").remove()})),FilePond.registerPlugin(FilePondPluginFileEncode,FilePondPluginFileValidateSize,FilePondPluginImageExifOrientation,FilePondPluginImagePreview,FilePondPluginFileValidateType);const i=FilePond.create(document.querySelector(".revision-msg-filepond"),{acceptedFileTypes:sv_front_ajax_object.file_types,allowFileEncode:!1,allowMultiple:!0,labelIdle:wp.i18n.__("Drag & Drop your files","surelywp-services")+' <span class="filepond--label-action">'+wp.i18n.__("or Browse","surelywp-services")+"</span>"});var n=[];function o(r,t,s,a="true"){e(r).after("<sc-alert closable="+a+" class='alert-msg' open type='"+s+"'>"+t+"</sc-alert>")}if(setTimeout((function(){e(".service-req-file").each((function(r,t){var s=e(t)[0],a=e(t).attr("name").match(/\[(\d+)\]/)[1];n[a]=FilePond.create(s,{acceptedFileTypes:sv_front_ajax_object.file_types,allowFileEncode:!1,allowMultiple:!0,labelIdle:wp.i18n.__("Drag & Drop your files","surelywp-services")+' <span class="filepond--label-action">'+wp.i18n.__("or Browse","surelywp-services")+"</span>"})})),e(".filepond--credits").remove()}),500),e(document).on("scNextPage scPrevPage","#sv-user-services-paginate",(function(r){var t;e(".services-list-table-card").addClass("loading-cursor"),e(".service-view-btn").addClass("loading-cursor"),e(".services-pagination").addClass("loading-cursor"),t="scNextPage"===r.type?1:0;var s=e("sc-pagination").attr("page"),a=e(".services-list-table").data("dashboard-page-id"),i=e(".services-list-table").data("surecart-db-tab");s=parseInt(s),e.ajax({url:sv_front_ajax_object.ajax_url,dataType:"json",type:"POST",data:{action:"surelywp_sv_get_user_service_paginate",next_page:t,current_page:s,db_page_id:a,surecart_db_tab:i,nonce:sv_front_ajax_object.nonce},success:function(r){e(".services-list-table-card").removeClass("loading-cursor"),e(".service-view-btn").removeClass("loading-cursor"),e(".services-pagination").removeClass("loading-cursor"),r.success&&(e("#services-list-table").html(r.service_table),e("sc-pagination").attr("page",t?++s:--s))}}).catch((r=>{e(".services-list-table-card").removeClass("loading-cursor"),e(".service-view-btn").removeClass("loading-cursor"),e(".services-pagination").removeClass("loading-cursor"),console.error("Error:",r)}))})),e(document).on("scFormSubmit",(function(r){if("surelywp-sv-contract-form"==r.target.classList[0]){r.preventDefault(),e(".alert-msg").length>0&&e(".alert-msg").remove(),e("#surelywp-sv-contract-form-btn").attr("loading","true"),e("#surelywp-sv-contract-form-btn").attr("disabled","true");var t=e("#surelywp_sv_contract_form_nonce").val(),s=e("#surelywp-sv-service-id").val(),a=new FormData;a.append("action","surelywp_sv_contract_form_sumbit_callback"),a.append("service_id",s),a.append("nonce",t),r.target.getFormJson().then((r=>{for(const[e,t]of Object.entries(r))a.append(e,t);e.ajax({url:sv_front_ajax_object.ajax_url,type:"POST",dataType:"json",data:a,processData:!1,contentType:!1,success:function(r){jQuery("html, body").animate({scrollTop:0},800),o(".services-item-list-heading",r.message,r.success?"success":"danger"),e("#surelywp-sv-contract-form-btn").attr("loading","false"),e("#surelywp-sv-contract-form-btn").removeAttr("disabled"),setTimeout((function(){window.location.reload()}),500)}})})).catch((e=>{console.error("Error:",e)}))}})),e(document).on("scFormSubmit",(function(r){if("surelywp-sv-requirement-form"==r.target.classList[0]){r.preventDefault(),e(".alert-msg").length>0&&e(".alert-msg").remove();var a=e("#is-external-req-form").val(),i=e("#surelywp-sv-is-product-page").val();a&&(e(".services-requirements-form.external .loader").removeClass("hidden"),e(".surelywp-sv-requirement-form").css("opacity","0.5"),t=!0),e("#surelywp-sv-requirement-form-btn").attr("loading","true"),e("#surelywp-sv-requirement-form-btn").attr("disabled","true");var l=e("#surelywp_sv_req_form_submit_nonce").val(),c=e("#surelywp-sv-service-id").val(),v=e("#surelywp-sv-service-setting-id").val(),d=e("#surelywp-sv-product-id").val(),u=new FormData;a?(u.append("action","surelywp_sv_external_req_form_sumbit_callback"),u.append("product_id",d)):(u.append("action","surelywp_sv_req_form_sumbit_callback"),u.append("service_id",c)),u.append("service_setting_id",v),u.append("nonce",l),r.target.getFormJson().then((r=>{for(const[e,t]of Object.entries(r))u.append(e,t);e(".service-requirement-desc").length&&e(".service-requirement-desc").each((function(){var r=e(this),t=r.attr("id"),s=r.attr("name"),a=tinyMCE.get(t)?tinyMCE.get(t).getContent():r.val();u.append(s,a)})),e(".service-requirement-text").length&&e(".service-requirement-text").each((function(){var r=e(this),t=r.attr("name"),s=r.val();u.append(t,s)})),e(".service-requirement-dropdown").length&&e(".service-requirement-dropdown").each((function(){var r=e(this),t=r.attr("name"),s=r.val();u.append(t,s)})),0!==n.length&&n.forEach((function(r,t){if(null!==r){var s=t,a=r.getFiles();e.each(a,(function(e,t){2==t.status?u.append("requirement_files["+s+"][]",t.file):r.removeFile(t.id)}))}})),e.ajax({url:sv_front_ajax_object.ajax_url,type:"POST",dataType:"json",data:u,processData:!1,contentType:!1,success:function(r){let n="";n=a?i?".wp-block-surecart-product-title":".services-requirements-form .loader":".services-item-list-heading",jQuery("html, body").animate({scrollTop:0},800),o(n,r.message,r.success?"success":"danger"),e("#surelywp-sv-requirement-form-btn").attr("loading","false"),e("#surelywp-sv-requirement-form-btn").removeAttr("disabled"),a?(r.success&&(i?s.target.click():e(".surelywp-sv-requirement-form").hide()),t=!1,e(".services-requirements-form.external .loader").addClass("hidden"),e(".surelywp-sv-requirement-form").css("opacity","1")):a||setTimeout((function(){window.location.reload()}),500)}})})).catch((e=>{console.error("Error:",e)}))}})),e(".customer-order-services").length>0)var l=setInterval((function(){var r=e(".customer-order-services");r.remove(),e(".sc-customer-dashboard.hydrated").after(r),e(".customer-order-services").length>0&&(r.removeClass("hidden"),clearInterval(l))}),2e3);function c(r){e("body").addClass("pointer-event-none");var t=new FormData,s=e("#surelywp_sv_handle_delivery_nonce").val(),a=e("#service-id").val(),i=e("#service-setting-id").val(),n=e("#milestone-id").length?e("#milestone-id").val():"no",o=e("#approve-message-id").val();t.append("action","surelywp_sv_handle_delivery"),t.append("nonce",s),t.append("service_id",a),t.append("service_setting_id",i),t.append("milestone_id",n),t.append("approve_message_id",o),t.append("is_approved",r),e.ajax({url:sv_front_ajax_object.ajax_url,type:"POST",dataType:"json",data:t,processData:!1,contentType:!1,success:function(t){"0"===r?e(".final-delivery-revision .loader").addClass("hidden"):e(".dellvery-approve .dellvery-top .loader").addClass("hidden"),window.location.reload()}}),e("body").removeClass("pointer-event-none")}if(e(document).on("click","#delivery-revision-button",(function(r){r.preventDefault(),e(".final-delivery-revision").addClass("show-modal")})),e(document).on("click","#cancel-delivery-revision",(function(r){r.preventDefault(),e(".final-delivery-revision").removeClass("show-modal"),e(".sv-error").length>0&&e(".sv-error").remove()})),e(document).on("click","#confirm-delivery-revision",(function(r){r.preventDefault(),e(".sv-error").length>0&&e(".sv-error").remove(),e(".final-delivery-revision.modal .modal-content").animate({scrollTop:0},"slow");var t=new FormData,s=e("#surelywp_sv_message_form_submit_nonce").val(),a=e("#surelywp-sv-service-id").val(),n=e("#message-receiver-id").val(),o=e("#delivery-revision-msg-text").val();""===(o=tinyMCE.get("delivery-revision-msg-text")?tinyMCE.get("delivery-revision-msg-text").getContent():e("#delivery-revision-msg-text").val())&&(o=e("#delivery-revision-msg-text").val());var l=e("#milestone-id").val(),v=e("#confirm-delivery-revision").attr("data-milestone-revision"),d=i.getFiles();if(e.each(d,(function(e,r){2==r.status?t.append("msg_attachment_file[]",r.file):i.removeFile(r.id)})),""!==o&&void 0!==o)e(".body").addClass("pointer-event-none"),e(".final-delivery-revision .modal-top .loader").removeClass("hidden"),t.append("action","surelywp_sv_message_form_sumbit_callback"),t.append("service_id",a),t.append("receiver_id",n),t.append("is_final_delivery",0),t.append("is_milestone_delivery_flag",0),t.append("is_data_milestone_revision",v),t.append("milestone_id",l),t.append("nonce",s),t.append("service_message",o),e.ajax({url:sv_front_ajax_object.ajax_url,type:"POST",dataType:"json",data:t,processData:!1,contentType:!1,success:function(r){if(e(".body").removeClass("pointer-event-none"),r.success){e(".delivery-revision-wrap").after('<p class="sv-success">Message sent successfully.</p>'),c("0")}else e(".delivery-revision-wrap").after('<p class="sv-error">'+r.message+"</p>");tinyMCE.get("delivery-revision-msg-text")&&tinyMCE.get("delivery-revision-msg-text").setContent(""),e("#delivery-revision-msg-text").val(""),setTimeout((function(){i.removeFiles()}),100)}});else{var u=wp.i18n.__("Please enter your message and try again.","surelywp-services");e(".delivery-revision-wrap").after('<p class="sv-error">'+u+"</p>")}})),e(document).on("click","#delivery-approve-button",(function(r){r.preventDefault(),e(".final-delivery-approve").addClass("show-modal")})),e(document).on("click","#cancel-delivery-change",(function(r){r.preventDefault(),e(".final-delivery-approve").removeClass("show-modal")})),e(document).on("click","#confirm-approve-delivery",(function(r){r.preventDefault(),e(".modal-top .loader").removeClass("hidden"),c("1")})),e(document).on("scFormSubmit","#new-service-request-form",(function(r){e("#surelywp-sv-request-service-form-submit-btn").attr("loading","true"),e("#surelywp-sv-request-service-form-submit-btn").attr("disabled","true");var t=e("#surelywp_sv_service_request_form_nonce").val(),s=e("#service-order-selection").val(),a=e("#dashboard-page-id").val();e.ajax({url:sv_front_ajax_object.ajax_url,type:"POST",dataType:"json",data:{action:"surelywp_sv_new_service_req",nonce:t,service_order:s,dashboard_page_id:a},success:function(r){e("#surelywp-sv-request-service-form-submit-btn").attr("loading","false"),e("#surelywp-sv-request-service-form-submit-btn").removeAttr("disabled"),o(".services-item-list-heading",r.message,r.status?"success":"danger","false"),r.status&&(window.location.href=r.redirect_url)}})})),e(".service-delivery-panel").length){var v=1e3*e("#service-delivery-panel").data("delivery-date");if((new Date).getTime()<=v)var d=v,u=setInterval((function(){var r=(new Date).getTime(),t=d-r,s=Math.floor(t/864e5),a=Math.floor(t%864e5/36e5),i=Math.floor(t%36e5/6e4),n=Math.floor(t%6e4/1e3);a/10<=1&&(a=a.toString().padStart(2,"0")),i/10<=1&&(i=i.toString().padStart(2,"0")),n/10<=1&&(n=n.toString().padStart(2,"0")),s/10<=1&&(s=s.toString().padStart(2,"0")),e(".service-delivery-panel .timer .days .count").html(s),e(".service-delivery-panel .timer .hours .count").html(a),e(".service-delivery-panel .timer .minutes .count").html(i),e(".service-delivery-panel .timer .seconds .count").html(n),t<=0&&(clearInterval(u),e(".service-delivery-panel .timer .count").html("00"))}),1e3);else e(".service-delivery-panel .timer .count").html("00")}}));